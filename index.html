<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- **CSP FIX UPDATED FOR BROADER COMPATIBILITY** -->
    <meta http-equiv="Content-Security-Policy" content="connect-src 'self' https://*.googleapis.com;">
    <title>Sam Arora | AI & DevSecOps Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
        }
        .nav-link {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-link.active {
            color: #A0522D;
            font-weight: 700;
            border-bottom: 2px solid #A0522D;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .resume-table th, .resume-table td {
            border: 1px solid #dee2e6;
            padding: 0.75rem;
            text-align: left;
        }
        .resume-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .chat-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        .chat-bubble.user {
            background-color: #A0522D;
            color: white;
        }
        .chat-bubble.ai {
            background-color: #e9ecef;
            color: #3B3C36;
        }
        .chat-bubble.thinking {
            background-color: #e9ecef;
        }
        .dot-flashing {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #A0522D;
            color: #A0522D;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: .5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
        }
        .dot-flashing::before {
            left: -15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #A0522D;
            color: #A0522D;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #A0522D;
            color: #A0522D;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }
        @keyframes dotFlashing {
            0% { background-color: #A0522D; }
            50%, 100% { background-color: #d2b48c; }
        }
    </style>
</head>
<body class="antialiased">

    <div class="flex flex-col lg:flex-row min-h-screen">
        <!-- Sidebar / Header -->
        <aside class="w-full lg:w-1/4 bg-white shadow-lg p-8 lg:min-h-screen">
            <div class="text-center lg:text-left">
                <h1 class="text-3xl font-extrabold text-[#3B3C36]">Sam Arora</h1>
                <p class="text-md text-[#A0522D] font-semibold mt-1">Principal AI/ML & DevSecOps Architect</p>
            </div>
            <nav class="mt-12">
                <ul class="space-y-4">
                    <li><a class="nav-link active block pb-2" data-target="resume">Full Resume</a></li>
                    <li><a class="nav-link block pb-2" data-target="interactive-report">Interactive Report</a></li>
                    <li><a class="nav-link block pb-2" data-target="chatbot">Chat with My AI</a></li>
                </ul>
            </nav>
            <div class="mt-12 text-center lg:text-left text-sm text-gray-600">
                <h3 class="font-bold text-gray-800 mb-2">Contact</h3>
                <p>sam.arora@samokash.com</p>
                <p>07706070809</p>
                <div class="flex justify-center lg:justify-start space-x-4 mt-4">
                     <a href="https://www.linkedin.com/in/sam-arora-2739b515/" target="_blank" class="text-[#A0522D] hover:underline">LinkedIn</a>
                     <a href="https://github.com/get2sammy" target="_blank" class="text-[#A0522D] hover:underline">GitHub</a>
                     <a href="https://huggingface.co/get2sammy" target="_blank" class="text-[#A0522D] hover:underline">Hugging Face</a>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="w-full lg:w-3/4 p-4 sm:p-8 md:p-12 overflow-y-auto">

            <!-- Resume Section -->
            <section id="resume" class="content-section active">
                 <div id="resume-content" class="bg-white p-8 rounded-lg shadow-md">
                    <div class="flex justify-between items-start mb-8">
                         <h2 class="text-3xl font-bold text-[#3B3C36]">Full Resume</h2>
                         <button id="download-pdf" class="bg-[#A0522D] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition">Download as PDF</button>
                    </div>
                     
                    <div class="border-b-2 border-gray-100 pb-6 mb-6">
                        <h3 class="text-2xl font-bold text-[#3B3C36]">Professional Summary</h3>
                        <p class="mt-2 text-gray-700 leading-relaxed">A highly accomplished and hands-on technology leader with over 20 years of experience architecting and delivering transformative AI, DevSecOps, and cloud solutions for the world's leading financial, insurance, and enterprise organizations. I excel at bridging the gap between C-suite vision and engineering execution, building high-performing teams, and designing future-proof platforms that are secure, scalable, and intelligent by default. My leadership is rooted in a passion for purposeful innovation, fostering a culture of experimentation and continuous learning to solve complex business challenges.</p>
                    </div>

                    <div class="border-b-2 border-gray-100 pb-6 mb-6">
                        <h3 class="text-2xl font-bold text-[#3B3C36]">Key Achievements</h3>
                        <ul class="list-disc list-inside mt-2 text-gray-700 space-y-2">
                            <li><strong>Delivered Â£100k+ in annual savings</strong> by re-architecting costly, persistent cloud infrastructure into an intelligent, on-demand resource model.</li>
                            <li><strong>Architected and deployed secure agentic AI applications</strong> for finance and insurance, ensuring full compliance with stringent NIST, ISO27001, and SOC standards.</li>
                            <li><strong>Led the design of secure, multi-region platforms on Azure and GCP,</strong> enabling high availability and disaster recovery for mission-critical enterprise workloads.</li>
                            <li><strong>Pioneered keyless authentication strategies in regulated cloud environments,</strong> eliminating secrets management risks and significantly enhancing enterprise security posture.</li>
                            <li><strong>Successfully presented AI innovation roadmaps to C-suite stakeholders,</strong> influencing enterprise-level investment and strategic direction at major global firms.</li>
                        </ul>
                    </div>

                    <div class="border-b-2 border-gray-100 pb-6 mb-6">
                        <h3 class="text-2xl font-bold text-[#3B3C36]">Technical Expertise</h3>
                        <div class="overflow-x-auto mt-4">
                            <table class="w-full border-collapse resume-table">
                                <thead>
                                    <tr><th>Category</th><th>Skills</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td><strong>AI / ML</strong></td><td>Llama 3.x, Fine-Tuning (Ollama, Hugging Face), RAG, Agentic Workflows, Azure OpenAI, GCP Vertex AI (Gemini), LangChain, Prompt Engineering, Model Ops</td></tr>
                                    <tr><td><strong>Cloud & Infrastructure</strong></td><td>Azure, GCP, AWS, Kubernetes (AKS, GKE), Terraform, Ansible, Multi-Region Architecture, Landing Zones, Infrastructure as Code (IaC)</td></tr>
                                    <tr><td><strong>DevSecOps & CI/CD</strong></td><td>GitHub Actions, Jenkins, GitLab CI, Prisma Cloud, SAST/DAST/SCA Integration, Policy-as-Code (OPA), Secretless Architecture</td></tr>
                                    <tr><td><strong>Security & Compliance</strong></td><td>ISO27001, NIST, SOC2, GDPR, Cloud Security Posture Management (CSPM), Secure SDLC, Keyless Authentication (OIDC, Workload Identity)</td></tr>
                                    <tr><td><strong>Languages & Frameworks</strong></td><td>Python, React, Node.js, Flask, PowerShell</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                     <div class="border-b-2 border-gray-100 pb-6 mb-6">
                        <h3 class="text-2xl font-bold text-[#3B3C36]">Marquee Engagements & Experience</h3>
                        <div class="mt-4 space-y-6">
                            <div>
                                <h4 class="text-lg font-bold">Director & Principal Consultant | Samokash Ltd</h4>
                                <p class="text-sm font-semibold text-gray-600">Apr 2023 â Present</p>
                                <p class="mt-2 text-gray-700 italic">Engaged by leading global firms to architect and deliver strategic AI, Cloud, and DevSecOps initiatives. Notable direct client engagements include:</p>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2 pl-4">
                                    <li><strong>Principal AI & Cloud Architect (Contract) |</strong> Legal & General (UK & America)</li>
                                    <li><strong>Principal DevSecOps Architect (Contract) |</strong> Euroclear & Pret (Concurrent Engagement)</li>
                                    <li><strong>Principal AI Strategist (Contract) |</strong> Chase</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold">Senior DevOps Engineer (AI/ML & DevSecOps) | London Stock Exchange</h4>
                                <p class="text-sm font-semibold text-gray-600">Aug 2022 â Apr 2023</p>
                            </div>
                             <div>
                                <h4 class="text-lg font-bold">Head of DevOps (Blockchain & AI Model Ops) | EY (Insurwave)</h4>
                                <p class="text-sm font-semibold text-gray-600">Mar 2018 â Jun 2020</p>
                            </div>
                        </div>
                    </div>
                     <div>
                        <h3 class="text-2xl font-bold text-[#3B3C36]">Previous Foundational Experience</h3>
                        <div class="mt-4 text-gray-700 space-y-1">
                             <p><strong>Bank of America</strong> â Project Lead / DevOps Engineer | Apr 2016 â Sep 2017</p>
                             <p><strong>Commerzbank (London)</strong> â Infrastructure Consultant | Jan 2016 â Apr 2016</p>
                             <p><strong>CLOSE BROTHERS GROUP (London)</strong> â Infrastructure, Security Consultant | Jan 2015 â Jan 2016</p>
                             <p><strong>MARKIT GROUP LTD</strong> â AVP DevOps, WinOps | Jul 2012 â Dec 2014</p>
                             <p><strong>CAPITA IT SERVICES</strong> - Windows Technical Lead/Deputy Team Leader | Jan 2008 â Jul 2012</p>
                             <p><strong>Microsoft (India)</strong> â EMEA Server Support/Operations | Mar 2002 â Mar 2004</p>
                        </div>
                     </div>
                 </div>
            </section>

            <!-- Interactive Report Section -->
            <section id="interactive-report" class="content-section">
                <div class="w-full h-[80vh] bg-white rounded-lg shadow-md">
                     <iframe id="report-iframe" class="w-full h-full border-0 rounded-lg" title="Interactive Report: The Career of Sam Arora"></iframe>
                </div>
            </section>
            
            <!-- Chatbot Section -->
            <section id="chatbot" class="content-section">
                <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md h-[80vh] flex flex-col">
                    <h2 class="text-3xl font-bold text-[#3B3C36] mb-4 border-b-2 border-gray-100 pb-4">Chat with My AI</h2>
                    <div id="chat-window" class="flex-grow overflow-y-auto p-4 space-y-4">
                        <div class="flex justify-start">
                            <div class="chat-bubble ai p-3 rounded-lg">
                                Hello! I am an AI assistant trained exclusively on Sam Arora's professional background. Ask me about his experience, skills, or projects.
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 border-t-2 border-gray-100 pt-4">
                        <div class="flex">
                            <input type="text" id="chat-input" placeholder="e.g., 'What is his experience with AI?'" class="flex-grow border rounded-l-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#A0522D]">
                            <button id="chat-send" class="bg-[#A0522D] text-white font-bold p-3 rounded-r-lg hover:bg-opacity-90 transition">Send</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const downloadPdfBtn = document.getElementById('download-pdf');

            // --- Navigation Logic ---
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetId = link.getAttribute('data-target');
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');
                    contentSections.forEach(section => {
                        section.classList.toggle('active', section.id === targetId);
                    });
                });
            });

            // --- PDF Download Logic ---
            downloadPdfBtn.addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const resumeContent = document.getElementById('resume-content');
                
                html2canvas(resumeContent, { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'pt',
                        format: 'a4'
                    });
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const canvasWidth = canvas.width;
                    const canvasHeight = canvas.height;
                    const ratio = canvasHeight / canvasWidth;
                    const height = pdfWidth * ratio;

                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, height);
                    pdf.save('Sam_Arora_Resume.pdf');
                });
            });

            // --- Embed Interactive Report ---
            const iframe = document.getElementById('report-iframe');
            const reportHTML = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Interactive Report: The Career of Sam Arora</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
                    <style>
                        body { font-family: 'Inter', sans-serif; background-color: #F5F5DC; color: #3B3C36; }
                        .chart-container { position: relative; width: 100%; max-width: 800px; margin: auto; height: 400px; max-height: 450px; }
                        .kpi-card { background-color: white; border-left: 5px solid #A0522D; }
                        .timeline-item::before { content: ''; position: absolute; left: -30px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; border-radius: 50%; background-color: white; border: 4px solid #A0522D; z-index: 1; }
                    <\/style>
                </head>
                <body class="antialiased">
                    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                         <header class="text-center mb-16"><h1 class="text-4xl md:text-5xl font-extrabold text-[#3B3C36] mb-3">Interactive Professional Report</h1><h2 class="text-2xl md:text-3xl font-bold text-[#A0522D]">Sam Arora</h2></header>
                         <section class="mb-20"><h3 class="text-3xl font-bold text-center text-[#3B3C36] mb-10">Key Performance Indicators</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><div class="kpi-card rounded-lg shadow-md p-6"><p class="text-5xl font-extrabold text-[#A0522D]">Â£100k+</p><p class="mt-2 text-lg font-semibold">Annual Cloud Savings</p></div><div class="kpi-card rounded-lg shadow-md p-6"><p class="text-5xl font-extrabold text-[#A0522D]">40%</p><p class="mt-2 text-lg font-semibold">Faster Onboarding</p></div><div class="kpi-card rounded-lg shadow-md p-6"><p class="text-5xl font-extrabold text-[#A0522D]">100%</p><p class="mt-2 text-lg font-semibold">Secret Elimination</p></div></div></section>
                         <section class="mb-20"><h3 class="text-3xl font-bold text-center text-[#3B3C36] mb-10">Technical Expertise Analysis</h3><div class="bg-white rounded-xl shadow-lg p-6 md:p-8"><div class="chart-container h-[500px] max-h-[600px] md:h-[600px] md:max-h-[700px]"><canvas id="expertiseChart"><\/canvas></div></div></section>
                         <section class="mb-20"><h3 class="text-3xl font-bold text-center text-[#3B3C36] mb-12">Marquee Engagements</h3><div class="max-w-3xl mx-auto"><div class="relative pl-8 border-l-4 border-[#D2B48C]"><div class="space-y-12"><div class="timeline-item relative"><div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm font-semibold text-[#A0522D]">Apr 2023 â Present</p><h4 class="text-xl font-bold mt-1">Director & Principal Consultant</h4><div class="mt-4 space-y-2 text-sm pl-4 border-l-2 border-[#D2B48C]"><p><strong>Principal Architect |</strong> Legal & General</p><p><strong>Principal Architect |</strong> Euroclear & Pret</p></div></div></div><div class="timeline-item relative"><div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm font-semibold text-[#A0522D]">Aug 2022 â Apr 2023</p><h4 class="text-xl font-bold mt-1">Senior DevOps Engineer</h4><p class="font-semibold text-gray-700">London Stock Exchange</p></div></div></div></div></div></section>
                    </main>
                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const expertiseData = { labels: ['Llama 3.x', 'Azure OpenAI', 'Terraform', 'Kubernetes', 'GitHub Actions', 'Policy-as-Code', 'Keyless Auth', 'Python'], datasets: [{ label: 'Proficiency', data: [95, 90, 98, 95, 99, 90, 98, 95], backgroundColor: ['#A0522D', '#B87333', '#C4A484', '#D2B48C', '#A0522D', '#B87333', '#C4A484', '#D2B48C'] }] };
                            const expertiseCtx = document.getElementById('expertiseChart');
                            if(expertiseCtx) { new Chart(expertiseCtx, { type: 'bar', data: expertiseData, options: { indexAxis: 'y', maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { display: false } } } } }); }
                        });
                    <\/script>
                </body>
                </html>
            `;
            iframe.srcdoc = reportHTML;

            // --- Chatbot Logic ---
            const chatWindow = document.getElementById('chat-window');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('chat-send');
            
            const resumeContext = `
                This is a professional profile for Sam Arora.

                **Core Identity:**
                - Title: Principal AI/ML & DevSecOps Architect
                - Experience: Over 20 years
                - Summary: A hands-on technology leader specializing in AI, DevSecOps, and cloud solutions. He bridges the gap between high-level strategy and technical execution.

                **Key Achievements (Quantifiable):**
                - Saved over Â£100k annually by optimizing cloud infrastructure.
                - Accelerated application onboarding by 40% with standardized platforms.
                - Eliminated 100% of static secrets in CI/CD pipelines via keyless authentication.

                **Technical Expertise Breakdown:**
                - AI/ML: Proficient with Large Language Models like Llama 3.x, and platforms like Azure OpenAI and GCP Vertex AI (Gemini). Skilled in fine-tuning, RAG (Retrieval-Augmented Generation), and building agentic workflows.
                - Cloud & Infrastructure: Expert in Azure, GCP, and AWS. Manages infrastructure as code using Terraform and Ansible. Expert in Kubernetes (AKS, GKE).
                - DevSecOps & CI/CD: Builds and secures pipelines using GitHub Actions, Jenkins, and GitLab CI. Uses Prisma Cloud for security and OPA (Open Policy Agent) for policy-as-code.
                - Security & Compliance Frameworks: Deep knowledge of ISO27001, NIST, SOC2, and GDPR. Implements secure SDLC and keyless authentication using OIDC.
                - Programming: Python, React, Node.js, Flask, PowerShell.

                **Recent Professional Engagements (Post-2022):**
                - Current Role: Director & Principal Consultant at Samokash Ltd (since April 2023).
                - Direct Client Work (as Principal Architect/Strategist): Legal & General (UK & America), Euroclear, Pret, and Chase. This work involves AI strategy, cloud architecture, and DevSecOps leadership.
                - Previous Role: Senior DevOps Engineer at London Stock Exchange (until April 2023).

                **Key Project Summaries:**
                - For Insurance (Local AI Model): Developed an internal, air-gapped AI system using a fine-tuned Llama 3 model to analyze sensitive medical data for underwriting, improving accuracy.
                - For Finance (AI Risk Guard): Built a safety system that acts as a firewall for LLM outputs to prevent hallucinations and bias.
                - For Cloud Security (Keyless Auth): Deployed a secretless access solution for GCP using Workload Identity Federation, eliminating the need for static service account keys.

                **Simulated Private Repository Insights:**
                - From private GitHub repo 'agentic-finance-framework': Contains code for a Python-based framework using LangChain to create financial analysis agents. The README highlights a modular design for swapping different LLMs and vector databases.
                - From private Hugging Face Space 'medical-llama-finetune': Includes notes on a project fine-tuning a Llama model on a private medical dataset. Key learning was the importance of data decontamination to prevent memorization of sensitive information.
            `;

            const sendMessage = async () => {
                const userInput = chatInput.value.trim();
                if (!userInput) return;

                appendMessage(userInput, 'user');
                chatInput.value = '';
                appendMessage('', 'thinking');

                const prompt = `You are an AI assistant for Sam Arora. Your ONLY knowledge source is the text provided below. Do NOT use any external information or prior training. Answer the user's question based *exclusively* on the provided context. If the answer cannot be found in the text, you MUST respond with "I can only answer questions based on Sam Arora's provided professional profile." Be professional and concise.\n\n== CONTEXT ==\n${resumeContext}\n\n== USER QUESTION ==\n${userInput}`;
                
                try {
                    const responseText = await getAiResponse(prompt, 'gemini');
                    document.querySelector('.thinking').parentElement.remove();
                    appendMessage(responseText, 'ai');
                } catch (error) {
                    document.querySelector('.thinking').parentElement.remove();
                    appendMessage('Sorry, I encountered an error. Please try again.', 'ai');
                    console.error('Error fetching AI response:', error);
                }
            };

            const getAiResponse = async (prompt, provider) => {
                const API_KEYS = {
                    gemini: "", // Leave empty to use injected key
                    anthropic: "YOUR_ANTHROPIC_API_KEY", // Replace with your key if using Anthropic
                    openai: "YOUR_OPENAI_API_KEY" // Replace with your key if using OpenAI
                };

                let apiUrl, payload, headers;

                switch(provider) {
                    case 'gemini':
                    default:
                        apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEYS.gemini}`;
                        headers = { 'Content-Type': 'application/json' };
                        payload = { contents: [{ parts: [{ text: prompt }] }] };
                        break;
                }

                const response = await fetch(apiUrl, { method: 'POST', headers: headers, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorBody = await response.text();
                    console.error("API Error Response:", errorBody);
                    throw new Error(`API request failed with status ${response.status}`);
                }
                const result = await response.json();

                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                }
                
                // Fallback for unexpected response structure
                if (result.error) {
                    console.error("API returned an error:", result.error.message);
                    return `I encountered an API error: ${result.error.message}`;
                }

                return "I'm sorry, I couldn't generate a valid response.";
            };

            const appendMessage = (text, type) => {
                const messageWrapper = document.createElement('div');
                const messageBubble = document.createElement('div');
                messageWrapper.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'}`;
                
                if (type === 'thinking') {
                    messageBubble.className = 'chat-bubble thinking p-4 rounded-lg flex items-center';
                    messageBubble.innerHTML = '<div class="dot-flashing"></div>';
                } else {
                    messageBubble.className = `chat-bubble ${type} p-3 rounded-lg`;
                    messageBubble.textContent = text;
                }
                
                messageWrapper.appendChild(messageBubble);
                chatWindow.appendChild(messageWrapper);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            };

            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        });
    </script>
</body>
</html>
